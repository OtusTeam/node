const autocannon = require('autocannon')

startBench()

// autocannon

function startBench () {
  const instance = autocannon({
    url: 'http://localhost:4000',
    connections: 100,
    duration: 15,
    debug: true,
    requests: [
      {
        method: 'GET',
        path: '/fast'
      }
    ]
  }, finishedBench)

  autocannon.track(instance)

  process.once('SIGINT', () => {
    instance.stop()
  })
}

function finishedBench (err, res) {
  // console.log('finished bench', err, res)
}


// ┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
// │ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
// ├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
// │ Latency │ 5 ms │ 6 ms │ 9 ms  │ 11 ms │ 6.03 ms │ 1.39 ms │ 35 ms │
// └─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
// ┌───────────┬─────────┬─────────┬─────────┬─────────┬─────────┬────────┬─────────┐
// │ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg     │ Stdev  │ Min     │
// ├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼────────┼─────────┤
// │ Req/Sec   │ 13151   │ 13151   │ 15367   │ 16111   │ 15328.8 │ 690.57 │ 13149   │
// ├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼────────┼─────────┤
// │ Bytes/Sec │ 3.71 MB │ 3.71 MB │ 4.33 MB │ 4.54 MB │ 4.32 MB │ 195 kB │ 3.71 MB │
// └───────────┴─────────┴─────────┴─────────┴─────────┴─────────┴────────┴─────────┘

// Req/Bytes counts sampled once per second.
// # of samples: 15

// 230k requests in 15.02s, 64.8 MB read


// ┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
// │ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
// ├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
// │ Latency │ 1 ms │ 2 ms │ 5 ms  │ 7 ms │ 2.33 ms │ 1.68 ms │ 92 ms │
// └─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
// ┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐
// │ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min     │
// ├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
// │ Req/Sec   │ 22271   │ 22271   │ 35711   │ 42303   │ 35209.07 │ 5278.14 │ 22261   │
// ├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
// │ Bytes/Sec │ 6.28 MB │ 6.28 MB │ 10.1 MB │ 11.9 MB │ 9.93 MB  │ 1.49 MB │ 6.28 MB │
// └───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘

// Req/Bytes counts sampled once per second.
// # of samples: 15

// 528k requests in 15.04s, 149 MB read